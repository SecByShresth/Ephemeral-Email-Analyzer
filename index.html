<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPHEMERAL | Email Header Analysis Tool</title>
    <meta name="description"
        content="Ephemeral, client-initiated email header analysis tool for security analysts. Deep header, auth, and infrastructure analysis without persistence.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: baseline;">
                <h1>EPHEMERAL | Email Header Analysis Tool</h1>
                <button class="btn btn-secondary" id="config-btn"
                    style="font-size: 0.6rem; padding: 5px 10px;">Configure APIs</button>
            </div>
            <div class="subtitle">Analyst-Grade Email Header & Infrastructure Analysis</div>

            <div id="config-panel" class="hidden"
                style="margin-top: 20px; padding: 15px; border: 1px dashed var(--text-color);">
                <div class="options-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <label style="font-size: 0.7rem; display: block; margin-bottom: 5px;">VirusTotal API Key</label>
                        <input type="password" id="vt-key-input" placeholder="Paste VT Key..."
                            style="width: 100%; padding: 8px; border: 1px solid var(--border-color); font-family: var(--font-mono);">
                    </div>
                    <div>
                        <label style="font-size: 0.7rem; display: block; margin-bottom: 5px;">AbuseIPDB API Key</label>
                        <input type="password" id="abuse-key-input" placeholder="Paste AbuseIPDB Key..."
                            style="width: 100%; padding: 8px; border: 1px solid var(--border-color); font-family: var(--font-mono);">
                    </div>
                </div>
                <div style="text-align: right; margin-top: 10px;">
                    <button class="btn" id="save-keys-btn" style="font-size: 0.7rem;">Save Keys Locally</button>
                </div>
            </div>
        </header>

        <nav class="mode-selector">
            <button class="mode-tab active" data-mode="full">Full Analysis</button>
            <button class="mode-tab" data-mode="ip">IP Analysis</button>
            <button class="mode-tab" data-mode="domain">Domain Analysis</button>
            <button class="mode-tab" data-mode="attachment">Attachment</button>
        </nav>

        <main>
            <!-- Mode: Full Analysis -->
            <section id="full-section" class="input-section active">
                <p class="mb-20">Paste raw email headers or upload an .eml file for deep analysis.</p>
                <textarea id="header-input" placeholder="Paste headers here... (e.g. Received: from...)"></textarea>

                <div class="options-grid">
                    <label class="option-item">
                        <input type="checkbox" id="reputation-lookup" checked> Enable Reputation Lookups (VT/AbuseIPDB)
                    </label>
                    <label class="option-item">
                        <input type="checkbox" id="compare-mode"> Comparison Mode
                    </label>
                </div>

                <div id="compare-input-wrapper" class="hidden">
                    <p class="mb-20">Paste "Known Legitimate" headers for comparison:</p>
                    <textarea id="compare-header-input" placeholder="Paste legitimate headers here..."></textarea>
                </div>

                <div class="input-actions">
                    <input type="file" id="file-upload" accept=".eml,.txt" style="display:none">
                    <button class="btn btn-secondary" onclick="document.getElementById('file-upload').click()">Upload
                        .eml</button>
                    <button class="btn" id="analyze-btn">Start Analysis</button>
                </div>
            </section>

            <!-- Mode: IP Analysis -->
            <section id="ip-section" class="input-section">
                <p class="mb-20">Enter one or more IP addresses (comma or newline separated).</p>
                <textarea id="ip-input" placeholder="8.8.8.8&#10;1.1.1.1"></textarea>
                <div class="input-actions">
                    <div></div>
                    <button class="btn" id="analyze-ip-btn">Analyze IPs</button>
                </div>
            </section>

            <!-- Mode: Domain Analysis -->
            <section id="domain-section" class="input-section">
                <p class="mb-20">Enter one or more domains (comma or newline separated).</p>
                <textarea id="domain-input" placeholder="google.com&#10;microsoft.com"></textarea>
                <div class="input-actions">
                    <div></div>
                    <button class="btn" id="analyze-domain-btn">Analyze Domains</button>
                </div>
            </section>

            <!-- Mode: Attachment -->
            <section id="attachment-section" class="input-section">
                <p class="mb-20">Upload an attachment for metadata & reputation analysis. No detonation occurs.</p>
                <div class="input-actions">
                    <input type="file" id="attach-upload" style="display:none">
                    <button class="btn" onclick="document.getElementById('attach-upload').click()">Select File</button>
                    <button class="btn" id="analyze-attach-btn" disabled>Analyze File</button>
                </div>
                <div id="attach-info" class="mt-40 hidden">
                    <table id="attach-table">
                        <!-- Populated by JS -->
                    </table>
                </div>
            </section>

            <!-- Results -->
            <div id="results-container">
                <div class="score-display">
                    <div class="score-circle">
                        <div class="score-value" id="total-score">--</div>
                        <div class="score-label">Risk Score</div>
                    </div>
                </div>

                <div class="summary-box" id="analyst-summary">
                    Analysis in progress...
                </div>

                <div id="sections-wrapper">
                    <!-- Sections like Auth, Anomaly, Infrastructure will be injected here -->
                </div>

                <div class="export-actions">
                    <button class="btn" id="export-md">Export Markdown</button>
                    <button class="btn btn-secondary" id="export-json">Export JSON</button>
                    <button class="btn btn-secondary" style="margin-left: auto;" id="clear-btn">Clear All Data</button>
                </div>
            </div>
        </main>

        <section class="privacy-section">
            <h2>Privacy & Trust</h2>
            <div class="privacy-grid">
                <div>
                    <strong>No Persistence</strong>
                    <p>No data is stored, logged, or cached. All analysis happens in memory.</p>
                </div>
                <div>
                    <strong>One-Time Execution</strong>
                    <p>Data is discarded immediately after you close the tab or clear manually.</p>
                </div>
                <div>
                    <strong>Minimalist Scoping</strong>
                    <p>API queries use only indicators (IPs, domains, hashes), never full content.</p>
                </div>
                <div>
                    <strong>Transparency</strong>
                    <p>Open source logic. No telemetry or tracking scripts included.</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script src="js/parser.js"></script>
    <script src="js/reputation.js"></script>
    <script src="js/analyzer.js"></script>
    <script src="js/exporter.js"></script>
    <script src="js/app.js"></script>
</body>

</html>
